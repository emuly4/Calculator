<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LUFA Library - Mass Storage Class Bootloader: Lib/VirtualFAT.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - Mass Storage Class Bootloader
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00035.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">VirtualFAT.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="a00038.html">VirtualFAT.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aca7c765dd0627e296657ff06450be666"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#aca7c765dd0627e296657ff06450be666">ReadEEPROMByte</a> (const uint8_t *const Address)</td></tr>
<tr class="separator:aca7c765dd0627e296657ff06450be666"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f8cd4c2423852928e1ff94da9979199"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#a4f8cd4c2423852928e1ff94da9979199">WriteEEPROMByte</a> (uint8_t *const Address, const uint8_t Data)</td></tr>
<tr class="separator:a4f8cd4c2423852928e1ff94da9979199"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8ef345bb680413d3ad7895b0aaa90aa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#aa8ef345bb680413d3ad7895b0aaa90aa">UpdateFAT12ClusterEntry</a> (uint8_t *const FATTable, const uint16_t Index, const uint16_t ChainEntry)</td></tr>
<tr class="separator:aa8ef345bb680413d3ad7895b0aaa90aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96499f2665912e76cf3d90928152b0d5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#a96499f2665912e76cf3d90928152b0d5">UpdateFAT12ClusterChain</a> (uint8_t *const FATTable, const uint16_t Index, const uint8_t ChainLength)</td></tr>
<tr class="separator:a96499f2665912e76cf3d90928152b0d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa551c1f4bfa2733a223c05d846496265"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#aa551c1f4bfa2733a223c05d846496265">ReadWriteFLASHFileBlock</a> (const uint16_t BlockNumber, uint8_t *BlockBuffer, const bool Read)</td></tr>
<tr class="separator:aa551c1f4bfa2733a223c05d846496265"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21bb69cd98d324d746582eec67911136"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#a21bb69cd98d324d746582eec67911136">ReadWriteEEPROMFileBlock</a> (const uint16_t BlockNumber, uint8_t *BlockBuffer, const bool Read)</td></tr>
<tr class="separator:a21bb69cd98d324d746582eec67911136"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a20670ed3f83163b0552d2c995615e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#a6a20670ed3f83163b0552d2c995615e5">VirtualFAT_WriteBlock</a> (const uint16_t BlockNumber)</td></tr>
<tr class="separator:a6a20670ed3f83163b0552d2c995615e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa2dd0d56c9ec75bee7395e9f9473468"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#afa2dd0d56c9ec75bee7395e9f9473468">VirtualFAT_ReadBlock</a> (const uint16_t BlockNumber)</td></tr>
<tr class="separator:afa2dd0d56c9ec75bee7395e9f9473468"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab72576ec65f7192a393828dfb8a32b36"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="a00048.html">FATBootBlock_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#ab72576ec65f7192a393828dfb8a32b36">BootBlock</a></td></tr>
<tr class="separator:ab72576ec65f7192a393828dfb8a32b36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefae20ede2ed6b2a3e34aedd037ebe44"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="a00052.html">FATDirectoryEntry_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#aefae20ede2ed6b2a3e34aedd037ebe44">FirmwareFileEntries</a> []</td></tr>
<tr class="separator:aefae20ede2ed6b2a3e34aedd037ebe44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11434af93ba38eba05b48c9e1582a61a"><td class="memItemLeft" align="right" valign="top">static const uint16_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#a11434af93ba38eba05b48c9e1582a61a">FLASHFileStartCluster</a> = &amp;<a class="el" href="a00035.html#aefae20ede2ed6b2a3e34aedd037ebe44">FirmwareFileEntries</a>[<a class="el" href="a00038.html#a06fc87d81c62e9abb8790b6e5713c55bac6231316c70fad072fbc59abc1d4a8e4">DISK_FILE_ENTRY_FLASH_MSDOS</a>].MSDOS_File.StartingCluster</td></tr>
<tr class="separator:a11434af93ba38eba05b48c9e1582a61a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf25c6825875d84f7150ddc7391cf93b"><td class="memItemLeft" align="right" valign="top">static const uint16_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00035.html#aaf25c6825875d84f7150ddc7391cf93b">EEPROMFileStartCluster</a> = &amp;<a class="el" href="a00035.html#aefae20ede2ed6b2a3e34aedd037ebe44">FirmwareFileEntries</a>[<a class="el" href="a00038.html#a06fc87d81c62e9abb8790b6e5713c55bad7b697a34d82b3b24ac773081440aa0a">DISK_FILE_ENTRY_EEPROM_MSDOS</a>].MSDOS_File.StartingCluster</td></tr>
<tr class="separator:aaf25c6825875d84f7150ddc7391cf93b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Virtualized FAT12 filesystem implementation, to perform self-programming in response to read and write requests to the virtual filesystem by the host PC. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aca7c765dd0627e296657ff06450be666"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca7c765dd0627e296657ff06450be666">&#9670;&nbsp;</a></span>ReadEEPROMByte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint8_t ReadEEPROMByte </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *const&#160;</td>
          <td class="paramname"><em>Address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reads a byte of EEPROM out from the EEPROM memory space.</p>
<dl class="section note"><dt>Note</dt><dd>This function is required as the avr-libc EEPROM functions do not cope with linker relaxations, and a jump longer than 4K of FLASH on the larger USB AVRs will break the linker. This function is marked as never inlinable and placed into the normal text segment so that the call to the EEPROM function will be short even if the AUX boot section is used.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Address</td><td>Address of the EEPROM location to read from</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Read byte of EEPROM data. </dd></dl>

</div>
</div>
<a id="a21bb69cd98d324d746582eec67911136"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21bb69cd98d324d746582eec67911136">&#9670;&nbsp;</a></span>ReadWriteEEPROMFileBlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ReadWriteEEPROMFileBlock </td>
          <td>(</td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>BlockNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>BlockBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>Read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reads or writes a block of data from/to the physical device EEPROM using a block buffer stored in RAM, if the requested block is within the virtual firmware file's sector ranges in the emulated FAT file system.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockNumber</td><td>Physical disk block to read from/write to </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">BlockBuffer</td><td>Pointer to the start of the block buffer in RAM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Read</td><td>If <code>true</code>, the requested block is read, if <code>false</code>, the requested block is written </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa551c1f4bfa2733a223c05d846496265"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa551c1f4bfa2733a223c05d846496265">&#9670;&nbsp;</a></span>ReadWriteFLASHFileBlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ReadWriteFLASHFileBlock </td>
          <td>(</td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>BlockNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>BlockBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>Read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reads or writes a block of data from/to the physical device FLASH using a block buffer stored in RAM, if the requested block is within the virtual firmware file's sector ranges in the emulated FAT file system.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockNumber</td><td>Physical disk block to read from/write to </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">BlockBuffer</td><td>Pointer to the start of the block buffer in RAM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Read</td><td>If <code>true</code>, the requested block is read, if <code>false</code>, the requested block is written </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a96499f2665912e76cf3d90928152b0d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96499f2665912e76cf3d90928152b0d5">&#9670;&nbsp;</a></span>UpdateFAT12ClusterChain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void UpdateFAT12ClusterChain </td>
          <td>(</td>
          <td class="paramtype">uint8_t *const&#160;</td>
          <td class="paramname"><em>FATTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>Index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>ChainLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Updates a FAT12 cluster chain in the FAT file table with a linear chain of the specified length.</p>
<dl class="section note"><dt>Note</dt><dd>FAT data cluster indexes are offset by 2, so that cluster 2 is the first file data cluster on the disk. See the FAT specification.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">FATTable</td><td>Pointer to the FAT12 allocation table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Index</td><td>Index of the start of the cluster chain to update </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ChainLength</td><td>Length of the chain to write, in clusters </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa8ef345bb680413d3ad7895b0aaa90aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8ef345bb680413d3ad7895b0aaa90aa">&#9670;&nbsp;</a></span>UpdateFAT12ClusterEntry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void UpdateFAT12ClusterEntry </td>
          <td>(</td>
          <td class="paramtype">uint8_t *const&#160;</td>
          <td class="paramname"><em>FATTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>Index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>ChainEntry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Updates a FAT12 cluster entry in the FAT file table with the specified next chain index. If the cluster is the last in the file chain, the magic value <code>0xFFF</code> should be used.</p>
<dl class="section note"><dt>Note</dt><dd>FAT data cluster indexes are offset by 2, so that cluster 2 is the first file data cluster on the disk. See the FAT specification.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">FATTable</td><td>Pointer to the FAT12 allocation table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Index</td><td>Index of the cluster entry to update </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ChainEntry</td><td>Next cluster index in the file chain </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afa2dd0d56c9ec75bee7395e9f9473468"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa2dd0d56c9ec75bee7395e9f9473468">&#9670;&nbsp;</a></span>VirtualFAT_ReadBlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VirtualFAT_ReadBlock </td>
          <td>(</td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>BlockNumber</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads a block of data from the virtual FAT filesystem, and sends it to the host via the USB Mass Storage interface.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockNumber</td><td>Index of the block to read. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6a20670ed3f83163b0552d2c995615e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a20670ed3f83163b0552d2c995615e5">&#9670;&nbsp;</a></span>VirtualFAT_WriteBlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VirtualFAT_WriteBlock </td>
          <td>(</td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>BlockNumber</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a block of data to the virtual FAT filesystem, from the USB Mass Storage interface.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockNumber</td><td>Index of the block to write. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4f8cd4c2423852928e1ff94da9979199"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f8cd4c2423852928e1ff94da9979199">&#9670;&nbsp;</a></span>WriteEEPROMByte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void WriteEEPROMByte </td>
          <td>(</td>
          <td class="paramtype">uint8_t *const&#160;</td>
          <td class="paramname"><em>Address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>Data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Writes a byte of EEPROM out to the EEPROM memory space.</p>
<dl class="section note"><dt>Note</dt><dd>This function is required as the avr-libc EEPROM functions do not cope with linker relaxations, and a jump longer than 4K of FLASH on the larger USB AVRs will break the linker. This function is marked as never inlinable and placed into the normal text segment so that the call to the EEPROM function will be short even if the AUX boot section is used.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Address</td><td>Address of the EEPROM location to write to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Data</td><td>New data to write to the EEPROM location </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab72576ec65f7192a393828dfb8a32b36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab72576ec65f7192a393828dfb8a32b36">&#9670;&nbsp;</a></span>BootBlock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="a00048.html">FATBootBlock_t</a> BootBlock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div><div class="line">    {</div><div class="line">        .Bootstrap               = {0xEB, 0x3C, 0x90},</div><div class="line">        .Description             = <span class="stringliteral">&quot;mkdosfs&quot;</span>,</div><div class="line">        .SectorSize              = <a class="code" href="a00038.html#acefb9aa0bfa178d2e7b367d28a9a99e8">SECTOR_SIZE_BYTES</a>,</div><div class="line">        .SectorsPerCluster       = <a class="code" href="a00038.html#aca148839c0d0d711a1f2d7475e98c033">SECTOR_PER_CLUSTER</a>,</div><div class="line">        .ReservedSectors         = 1,</div><div class="line">        .FATCopies               = 2,</div><div class="line">        .RootDirectoryEntries    = (<a class="code" href="a00038.html#acefb9aa0bfa178d2e7b367d28a9a99e8">SECTOR_SIZE_BYTES</a> / <span class="keyword">sizeof</span>(<a class="code" href="a00052.html">FATDirectoryEntry_t</a>)),</div><div class="line">        .TotalSectors16          = <a class="code" href="a00038.html#a74ba398e7640ffa25cfd45e346ba7c17">LUN_MEDIA_BLOCKS</a>,</div><div class="line">        .MediaDescriptor         = 0xF8,</div><div class="line">        .SectorsPerFAT           = 1,</div><div class="line">        .SectorsPerTrack         = (<a class="code" href="a00038.html#a74ba398e7640ffa25cfd45e346ba7c17">LUN_MEDIA_BLOCKS</a> % 64),</div><div class="line">        .Heads                   = (<a class="code" href="a00038.html#a74ba398e7640ffa25cfd45e346ba7c17">LUN_MEDIA_BLOCKS</a> / 64),</div><div class="line">        .HiddenSectors           = 0,</div><div class="line">        .TotalSectors32          = 0,</div><div class="line">        .PhysicalDriveNum        = 0,</div><div class="line">        .ExtendedBootRecordSig   = 0x29,</div><div class="line">        .VolumeSerialNumber      = 0x12345678,</div><div class="line">        .VolumeLabel             = <span class="stringliteral">&quot;LUFA BOOT  &quot;</span>,</div><div class="line">        .FilesystemIdentifier    = <span class="stringliteral">&quot;FAT12   &quot;</span>,</div><div class="line">    }</div><div class="ttc" id="a00038_html_aca148839c0d0d711a1f2d7475e98c033"><div class="ttname"><a href="a00038.html#aca148839c0d0d711a1f2d7475e98c033">SECTOR_PER_CLUSTER</a></div><div class="ttdeci">#define SECTOR_PER_CLUSTER</div><div class="ttdef"><b>Definition:</b> VirtualFAT.h:50</div></div>
<div class="ttc" id="a00038_html_a74ba398e7640ffa25cfd45e346ba7c17"><div class="ttname"><a href="a00038.html#a74ba398e7640ffa25cfd45e346ba7c17">LUN_MEDIA_BLOCKS</a></div><div class="ttdeci">#define LUN_MEDIA_BLOCKS</div><div class="ttdef"><b>Definition:</b> VirtualFAT.h:75</div></div>
<div class="ttc" id="a00038_html_acefb9aa0bfa178d2e7b367d28a9a99e8"><div class="ttname"><a href="a00038.html#acefb9aa0bfa178d2e7b367d28a9a99e8">SECTOR_SIZE_BYTES</a></div><div class="ttdeci">#define SECTOR_SIZE_BYTES</div><div class="ttdef"><b>Definition:</b> VirtualFAT.h:53</div></div>
<div class="ttc" id="a00052_html"><div class="ttname"><a href="a00052.html">FATDirectoryEntry_t</a></div><div class="ttdef"><b>Definition:</b> VirtualFAT.h:224</div></div>
</div><!-- fragment --><p>FAT filesystem boot sector block, must be the first sector on the physical disk so that the host can identify the presence of a FAT filesystem. This block is truncated; normally a large bootstrap section is located near the end of the block for booting purposes however as this is not meant to be a bootable disk it is omitted for space reasons.</p>
<dl class="section note"><dt>Note</dt><dd>When returning the boot block to the host, the magic signature 0xAA55 must be added to the very end of the block to identify it as a boot block. </dd></dl>

</div>
</div>
<a id="aaf25c6825875d84f7150ddc7391cf93b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf25c6825875d84f7150ddc7391cf93b">&#9670;&nbsp;</a></span>EEPROMFileStartCluster</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const uint16_t* EEPROMFileStartCluster = &amp;<a class="el" href="a00035.html#aefae20ede2ed6b2a3e34aedd037ebe44">FirmwareFileEntries</a>[<a class="el" href="a00038.html#a06fc87d81c62e9abb8790b6e5713c55bad7b697a34d82b3b24ac773081440aa0a">DISK_FILE_ENTRY_EEPROM_MSDOS</a>].MSDOS_File.StartingCluster</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Starting cluster of the virtual EEPROM.BIN file on disk, tracked so that the offset from the start of the data sector can be determined. On Windows systems files are usually replaced using the original file's disk clusters, while Linux appears to overwrite with an offset which must be compensated for. </p>

</div>
</div>
<a id="aefae20ede2ed6b2a3e34aedd037ebe44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefae20ede2ed6b2a3e34aedd037ebe44">&#9670;&nbsp;</a></span>FirmwareFileEntries</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00052.html">FATDirectoryEntry_t</a> FirmwareFileEntries[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>FAT 8.3 style directory entry, for the virtual FLASH contents file. </p>

</div>
</div>
<a id="a11434af93ba38eba05b48c9e1582a61a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11434af93ba38eba05b48c9e1582a61a">&#9670;&nbsp;</a></span>FLASHFileStartCluster</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const uint16_t* FLASHFileStartCluster = &amp;<a class="el" href="a00035.html#aefae20ede2ed6b2a3e34aedd037ebe44">FirmwareFileEntries</a>[<a class="el" href="a00038.html#a06fc87d81c62e9abb8790b6e5713c55bac6231316c70fad072fbc59abc1d4a8e4">DISK_FILE_ENTRY_FLASH_MSDOS</a>].MSDOS_File.StartingCluster</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Starting cluster of the virtual FLASH.BIN file on disk, tracked so that the offset from the start of the data sector can be determined. On Windows systems files are usually replaced using the original file's disk clusters, while Linux appears to overwrite with an offset which must be compensated for. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8f3de2ae926fecfe6abd5379fd2b6eb1.html">Lib</a></li><li class="navelem"><a class="el" href="a00035.html">VirtualFAT.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
