<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LUFA Library - Mass Storage Device Demo: MassStorage.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - Mass Storage Device Demo
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00026.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">MassStorage.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="a00029.html">MassStorage.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb27e569c06a2797c5fd58ed39147448"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#acb27e569c06a2797c5fd58ed39147448">SetupHardware</a> (void)</td></tr>
<tr class="separator:acb27e569c06a2797c5fd58ed39147448"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeff97648c9250a3d398bb0b74f040899"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#aeff97648c9250a3d398bb0b74f040899">EVENT_USB_Device_Connect</a> (void)</td></tr>
<tr class="separator:aeff97648c9250a3d398bb0b74f040899"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae88405d14d8d6dada9313520cb1501ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#ae88405d14d8d6dada9313520cb1501ec">EVENT_USB_Device_Disconnect</a> (void)</td></tr>
<tr class="separator:ae88405d14d8d6dada9313520cb1501ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a953a275884b9e33629ff6323fca05252"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#a953a275884b9e33629ff6323fca05252">EVENT_USB_Device_ConfigurationChanged</a> (void)</td></tr>
<tr class="separator:a953a275884b9e33629ff6323fca05252"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f4ce439a74a152e3c8ffda5c7dd201a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#a3f4ce439a74a152e3c8ffda5c7dd201a">EVENT_USB_Device_ControlRequest</a> (void)</td></tr>
<tr class="separator:a3f4ce439a74a152e3c8ffda5c7dd201a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2366751aad393f7e49384b76dfdbfc05"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#a2366751aad393f7e49384b76dfdbfc05">MassStorage_Task</a> (void)</td></tr>
<tr class="separator:a2366751aad393f7e49384b76dfdbfc05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a198e781643cf3ee5aa8bea888b3a2ab4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#a198e781643cf3ee5aa8bea888b3a2ab4">ReadInCommandBlock</a> (void)</td></tr>
<tr class="separator:a198e781643cf3ee5aa8bea888b3a2ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35e2afa9515551556bdb41d29f6b9eb2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#a35e2afa9515551556bdb41d29f6b9eb2">ReturnCommandStatus</a> (void)</td></tr>
<tr class="separator:a35e2afa9515551556bdb41d29f6b9eb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a8e8a77cbe2bac91f6acf20dc75d8aaf5"><td class="memItemLeft" align="right" valign="top">MS_CommandBlockWrapper_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#a8e8a77cbe2bac91f6acf20dc75d8aaf5">CommandBlock</a></td></tr>
<tr class="separator:a8e8a77cbe2bac91f6acf20dc75d8aaf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcca4b7ba22146b63e0b80e23b340e4c"><td class="memItemLeft" align="right" valign="top">MS_CommandStatusWrapper_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#adcca4b7ba22146b63e0b80e23b340e4c">CommandStatus</a> = { .Signature = MS_CSW_SIGNATURE }</td></tr>
<tr class="separator:adcca4b7ba22146b63e0b80e23b340e4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa696f7a79b9109ea7f508d87861e1bf9"><td class="memItemLeft" align="right" valign="top">volatile bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#aa696f7a79b9109ea7f508d87861e1bf9">IsMassStoreReset</a> = false</td></tr>
<tr class="separator:aa696f7a79b9109ea7f508d87861e1bf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main source file for the Mass Storage demo. This file contains the main tasks of the demo and is responsible for the initial application hardware configuration. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a953a275884b9e33629ff6323fca05252"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a953a275884b9e33629ff6323fca05252">&#9670;&nbsp;</a></span>EVENT_USB_Device_ConfigurationChanged()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EVENT_USB_Device_ConfigurationChanged </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Event handler for the USB_ConfigurationChanged event. This is fired when the host set the current configuration of the USB device after enumeration - the device endpoints are configured and the Mass Storage management task started. </p>

</div>
</div>
<a id="aeff97648c9250a3d398bb0b74f040899"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeff97648c9250a3d398bb0b74f040899">&#9670;&nbsp;</a></span>EVENT_USB_Device_Connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EVENT_USB_Device_Connect </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Event handler for the USB_Connect event. This indicates that the device is enumerating via the status LEDs. </p>

</div>
</div>
<a id="a3f4ce439a74a152e3c8ffda5c7dd201a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f4ce439a74a152e3c8ffda5c7dd201a">&#9670;&nbsp;</a></span>EVENT_USB_Device_ControlRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EVENT_USB_Device_ControlRequest </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Event handler for the USB_ControlRequest event. This is used to catch and process control requests sent to the device from the USB host before passing along unhandled control requests to the library for processing internally. </p>

</div>
</div>
<a id="ae88405d14d8d6dada9313520cb1501ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae88405d14d8d6dada9313520cb1501ec">&#9670;&nbsp;</a></span>EVENT_USB_Device_Disconnect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EVENT_USB_Device_Disconnect </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Event handler for the USB_Disconnect event. This indicates that the device is no longer connected to a host via the status LEDs and stops the Mass Storage management task. </p>

</div>
</div>
<a id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840291bc02cba5474a4cb46a9b9566fe">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Main program entry point. This routine configures the hardware required by the application, then enters a loop to run the application tasks in sequence. </p>

</div>
</div>
<a id="a2366751aad393f7e49384b76dfdbfc05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2366751aad393f7e49384b76dfdbfc05">&#9670;&nbsp;</a></span>MassStorage_Task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MassStorage_Task </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Task to manage the Mass Storage interface, reading in Command Block Wrappers from the host, processing the SCSI commands they contain, and returning Command Status Wrappers back to the host to indicate the success or failure of the last issued command. </p>

</div>
</div>
<a id="a198e781643cf3ee5aa8bea888b3a2ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a198e781643cf3ee5aa8bea888b3a2ab4">&#9670;&nbsp;</a></span>ReadInCommandBlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool ReadInCommandBlock </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function to read in a command block from the host, via the bulk data OUT endpoint. This function reads in the next command block if one has been issued, and performs validation to ensure that the block command is valid.</p>
<dl class="section return"><dt>Returns</dt><dd>Boolean <code>true</code> if a valid command block has been read in from the endpoint, <code>false</code> otherwise </dd></dl>

</div>
</div>
<a id="a35e2afa9515551556bdb41d29f6b9eb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35e2afa9515551556bdb41d29f6b9eb2">&#9670;&nbsp;</a></span>ReturnCommandStatus()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ReturnCommandStatus </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the filled Command Status Wrapper back to the host via the bulk data IN endpoint, waiting for the host to clear any stalled data endpoints as needed. </p>

</div>
</div>
<a id="acb27e569c06a2797c5fd58ed39147448"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb27e569c06a2797c5fd58ed39147448">&#9670;&nbsp;</a></span>SetupHardware()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetupHardware </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configures the board hardware and chip peripherals for the demo's functionality. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a8e8a77cbe2bac91f6acf20dc75d8aaf5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e8a77cbe2bac91f6acf20dc75d8aaf5">&#9670;&nbsp;</a></span>CommandBlock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MS_CommandBlockWrapper_t CommandBlock</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Structure to hold the latest Command Block Wrapper issued by the host, containing a SCSI command to execute. </p>

</div>
</div>
<a id="adcca4b7ba22146b63e0b80e23b340e4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcca4b7ba22146b63e0b80e23b340e4c">&#9670;&nbsp;</a></span>CommandStatus</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MS_CommandStatusWrapper_t CommandStatus = { .Signature = MS_CSW_SIGNATURE }</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Structure to hold the latest Command Status Wrapper to return to the host, containing the status of the last issued command. </p>

</div>
</div>
<a id="aa696f7a79b9109ea7f508d87861e1bf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa696f7a79b9109ea7f508d87861e1bf9">&#9670;&nbsp;</a></span>IsMassStoreReset</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile bool IsMassStoreReset = false</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flag to asynchronously abort any in-progress data transfers upon the reception of a mass storage reset command. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00026.html">MassStorage.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
