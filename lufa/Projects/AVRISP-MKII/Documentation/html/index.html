<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AVRISP-MKII Clone Programmer Project: AVRISP MKII Programmer Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AVRISP-MKII Clone Programmer Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">AVRISP MKII Programmer Project </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Sec_Compat"></a>
Project Compatibility</h1>
<p>The following list indicates what microcontrollers are compatible with this project.</p>
<ul>
<li>Series 7 USB AVRs (AT90USBxxx7) </li>
<li>Series 6 USB AVRs (AT90USBxxx6) </li>
<li>Series 4 USB AVRs (ATMEGAxxU4) </li>
<li>Series 2 USB AVRs (AT90USBxx2, ATMEGAxxU2) - <em>8KB versions with reduced features only</em></li>
</ul>
<h1><a class="anchor" id="Sec_Info"></a>
USB Information</h1>
<p>The following table gives a rundown of the USB utilization of this project.</p>
<table class="doxtable">
<tr>
<td><b>USB Mode:</b> </td><td>Device  </td></tr>
<tr>
<td><b>USB Class:</b> </td><td>Vendor Specific Class  </td></tr>
<tr>
<td><b>USB Subclass:</b> </td><td>N/A  </td></tr>
<tr>
<td><b>Relevant Standards:</b> </td><td>Atmel AVRISP MKII Protocol Specification  </td></tr>
<tr>
<td><b>Supported USB Speeds:</b> </td><td>Full Speed Mode  </td></tr>
</table>
<h1><a class="anchor" id="Sec_Description"></a>
Project Description</h1>
<p>Firmware for an Atmel Studio compatible AVRISP-MKII clone programmer. This project will enable the USB AVR series of microcontrollers to act as a clone of the official Atmel AVRISP-MKII programmer, usable within Atmel Studio or with any software capable of driving a real Atmel AVRISP-MKII programmer. In its most basic form, it allows for the programming of AVR TINY, MEGA and XMEGA devices at the programmer's VCC voltage from within Atmel Studio with no special hardware other than the USB AVR and the parts needed for the USB interface. If the user desires, more advanced circuits incorporating level conversion can be made to allow for the programming of target AVRs running at a different voltage to the programmer.</p>
<p>This device spoofs Atmel's official AVRISP-MKII device PID so that it remains compatible with Atmel's AVRISP-MKII drivers. It is currently tested working under the following configurations:</p>
<ul>
<li><b>Windows:</b> Atmel Studio 7, with alternative driver</li>
<li><b>Windows:</b> AVRDUDE 6.2, with alternative driver</li>
<li><b>Linux:</b> AVRDUDE 6.1</li>
</ul>
<p><b>Note that this clone requires a libUSB based driver under Windows,</b> due to an incompatible change in the official Jungo based driver. The alternative driver given here will function with both real and clone AVRISP devices in Atmel Studio 7 onwards under Windows - and as a bonus, also provides AVRDude access to the programmer.</p>
<p>As of Atmel Studio version 7.0.1417 the legacy Jungo driver has been deprecated in favor of an official libUSB based driver, making the driver packaged here superfluous. Use the driver packaged here only if you are still using an earlier Atmel Studio 7 build, otherwise the official Atmel libUSB driver should be used.</p>
<p>Note that this design currently has the following limitations:</p><ul>
<li>No reversed/shorted target connector detection and notification</li>
<li>A separate header is required for each of the ISP, PDI and TPI programming protocols that the user wishes to use</li>
</ul>
<p>On AVR models with an ADC converter, the USB AVR's AVCC pin should be tied to 5V (e.g. VBUS) and the <code>VTARGET_ADC_CHANNEL</code> token should be set to an appropriate ADC channel number in the project makefile for VTARGET detection to operate correctly. On models without an ADC converter, VTARGET will report a fixed 3.3V level at all times which should allow the programmer to remain compatible at the protocol level with all AVR devices.</p>
<p>While this application can be compiled for USB AVRs with as little as 8KB of FLASH, for full functionality 16KB or more of FLASH is required. On 8KB devices, ISP or PDI/TPI protocol programming support can be disabled to reduce program size.</p>
<h1><a class="anchor" id="Sec_Installation"></a>
Installation</h1>
<p>The programmer supports multiple platforms, both Windows and Linux.</p>
<h2><a class="anchor" id="SSec_LinuxInstallation"></a>
Linux Installation</h2>
<p>On Linux systems, the programmer should be usable out of the box with no special setup other than (on some systems) editing of the system permissions to allow the programmer to be used from a non-elevated (root) context. The programmer is compatible with the free open source AVRDude programming software project.</p>
<h2><a class="anchor" id="SSec_WindowsInstallation"></a>
Windows Installation</h2>
<p>On Windows systems, due to an unfortunate limitation of the USB AVR devices and the Atmel Studio platform, the programmer requires an alternative libUSB based driver. Uninstall the existing Jungo driver for the device (if installed) and replace it with the driver that ships with this project, to enable access to the programmer in Atmel Studio and AVRDUDE.</p>
<h1><a class="anchor" id="Sec_ISP"></a>
ISP Connections</h1>
<p>Connections to the device for SPI programming (when enabled):</p>
<table class="doxtable">
<tr>
<th><b>Programmer Pin:</b> </th><th><b>Target Device Pin:</b> </th><th><b>ISP 6 Pin Layout:</b>  </th></tr>
<tr>
<td>MISO </td><td>PDO </td><td>1  </td></tr>
<tr>
<td>ADCx <b><sup>1</sup></b> </td><td>VTARGET </td><td>2  </td></tr>
<tr>
<td>SCLK </td><td>SCLK </td><td>3  </td></tr>
<tr>
<td>MOSI </td><td>PDI </td><td>4  </td></tr>
<tr>
<td>PORTx.y <b><sup>2</sup></b> </td><td>/RESET </td><td>5  </td></tr>
<tr>
<td>GND </td><td>GND </td><td>6  </td></tr>
</table>
<p>In addition, the AVR's OCR1A pin will generate a 4MHz clock, to act as an external rescue device clock if the fuses have been mis-set. To use the recovery clock, connect the OCR1A pin of the USB AVR to the target AVR's XTAL1 pin, and set the ISP programming speed to 125KHz (note: other ISP speeds will not work correctly).</p>
<p><b><sup>1</sup></b> <em>Optional, see <a class="el" href="index.html#Sec_Options">Project Options</a> section - for USB AVRs with ADC modules only</em> <br />
 <b><sup>2</sup></b> <em>See AUX line related tokens in the <a class="el" href="index.html#Sec_Options">Project Options</a> section</em></p>
<h1><a class="anchor" id="Sec_PDI"></a>
PDI Connections</h1>
<p>Connections to the device for PDI programming (when enabled):</p>
<table class="doxtable">
<tr>
<th><b>Programmer Pin:</b> </th><th><b>Target Device Pin:</b> </th><th><b>PDI 6 Pin Layout:</b>  </th></tr>
<tr>
<td>Tx/Rx <b><sup>2</sup></b> </td><td>DATA </td><td>1  </td></tr>
<tr>
<td>ADCx <b><sup>1</sup></b> </td><td>VTARGET </td><td>2  </td></tr>
<tr>
<td>N/A </td><td>N/A </td><td>3  </td></tr>
<tr>
<td>N/A </td><td>N/A </td><td>4  </td></tr>
<tr>
<td>XCK </td><td>CLOCK </td><td>5  </td></tr>
<tr>
<td>GND </td><td>GND </td><td>6  </td></tr>
</table>
<p><b><sup>1</sup></b> <em>Optional, see <a class="el" href="index.html#Sec_Options">Project Options</a> section - for USB AVRs with ADC modules only</em> <br />
 <b><sup>2</sup></b> <em>The AVR's Tx and Rx become the DATA line when connected together via a pair of 220 ohm resistors</em> <br />
 </p>
<h1><a class="anchor" id="Sec_TPI"></a>
TPI Connections</h1>
<p>Connections to the device for TPI programming (when enabled):</p>
<table class="doxtable">
<tr>
<th><b>Programmer Pin:</b> </th><th><b>Target Device Pin:</b> </th><th><b>TPI 6 Pin Layout:</b>  </th></tr>
<tr>
<td>Tx/Rx <b><sup>2</sup></b> </td><td>DATA </td><td>1  </td></tr>
<tr>
<td>ADCx <b><sup>1</sup></b> </td><td>VTARGET </td><td>2  </td></tr>
<tr>
<td>XCK <b><sup>2</sup></b> </td><td>CLOCK </td><td>3  </td></tr>
<tr>
<td>N/A </td><td>N/A </td><td>4  </td></tr>
<tr>
<td>PORTx.y <b><sup>3</sup></b> </td><td>/RESET </td><td>5  </td></tr>
<tr>
<td>GND </td><td>GND </td><td>6  </td></tr>
</table>
<p><b><sup>1</sup></b> <em>Optional, see <a class="el" href="index.html#Sec_Options">Project Options</a> section - for USB AVRs with ADC modules only</em> <br />
 <b><sup>2</sup></b> <em>The AVR's Tx and Rx become the DATA line when connected together via a pair of 220 ohm resistors</em> <br />
 <b><sup>3</sup></b> <em>See AUX line related tokens in the <a class="el" href="index.html#Sec_Options">Project Options</a> section</em></p>
<h1><a class="anchor" id="Sec_Options"></a>
Project Options</h1>
<p>The following defines can be found in this project, which can control the project behaviour when defined, or changed in value.</p>
<table class="doxtable">
<tr>
<th><b>Define Name:</b> </th><th><b>Location:</b> </th><th><b>Description:</b>  </th></tr>
<tr>
<td>AUX_LINE_PORT </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>PORT register for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <br />
 <br />
 <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>AUX_LINE_PIN </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>PIN register for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <br />
 <br />
 <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>AUX_LINE_DDR </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>DDR register for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <br />
 <br />
 <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>AUX_LINE_MASK </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Mask for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <b>Must not be the AVR's /SS pin</b>. <br />
 <br />
 <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>VTARGET_ADC_CHANNEL </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>ADC channel number (on supported AVRs) to use for VTARGET level detection, if NO_VTARGET_DETECT is not defined. <br />
 <br />
 <em>Ignored when compiled for targets lacking an ADC.</em>  </td></tr>
<tr>
<td>ENABLE_ISP_PROTOCOL </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Define to enable SPI programming protocol support. <br />
 <br />
 <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>ENABLE_XPROG_PROTOCOL </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Define to enable PDI and TPI programming protocol support. <br />
 <br />
 <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>NO_VTARGET_DETECT </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Define to disable VTARGET sampling and reporting on AVR models with an ADC converter. This will cause the programmer to report a fixed 3.3V target voltage to the host regardless of the real target voltage. <br />
 <br />
 <em>Ignored when compiled for targets lacking an ADC.</em>  </td></tr>
<tr>
<td>VTARGET_REF_VOLTS </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Indicates the programmer AVR's AVCC reference voltage when measuring the target's supply voltage. Note that the supply voltage should never exceed the reference voltage on the programmer AVR without some form of protection to prevent damage to the ADC. <br />
 <br />
 <em>Ignored when compiled for targets lacking an ADC, or when NO_VTARGET_DETECT is defined.</em>  </td></tr>
<tr>
<td>VTARGET_USE_INTERNAL_REF </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Selects the internal 2.56V ADC reference voltage, instead of using the AVR's VREF pin. When enabled, this option will override the VTARGET_REF_VOLTS configuration option. <br />
 <br />
 <em>Ignored when compiled for targets lacking an ADC, or when NO_VTARGET_DETECT is defined.</em>  </td></tr>
<tr>
<td>VTARGET_SCALE_FACTOR </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Indicates the target's supply voltage scale factor when applied to the ADC. A simple resistive divider can be used on the ADC pin for measuring the target's supply voltage, so that voltages above the programmer AVR's AVCC reference voltage can be measured. This should be the reciprocal of the division performed - e.g. if the VTARGET voltage is halved, this should be set to 2. <br />
 <br />
 <em>Ignored when compiled for targets lacking an ADC, or when NO_VTARGET_DETECT is defined.</em>  </td></tr>
<tr>
<td>XCK_RESCUE_CLOCK_ENABLE </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Define to move the ISP rescue clock to the AVR's XCK pin instead of the OCR1A output pin. This is useful for existing programming hardware that does not expose the OCR1A pin of the AVR, but <em>may</em> cause some issues with PDI programming mode.  </td></tr>
<tr>
<td>INVERTED_ISP_MISO </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Define to invert the received data on the ISP MISO line. This is sometimes needed depending on the level translation hardware used, if the translator hardware inverts the received logic level.  </td></tr>
<tr>
<td>FIRMWARE_VERSION_MINOR </td><td><a class="el" href="a00017.html" title="Application Configuration Header File. ">AppConfig.h</a> </td><td>Define to set the minor firmware revision nunber reported to the host on request. By default this will use a firmware version compatible with the latest Atmel IDE version, however if desired the reported minor value can be adjusted here.  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
